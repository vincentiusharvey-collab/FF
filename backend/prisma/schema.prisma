generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  EDITOR
  VIEWER
}

enum PetType {
  DOG
  CAT
  BIRD
  RABBIT
  REPTILE
  OTHER
}

enum PetGender {
  MALE
  FEMALE
  UNKNOWN
}

enum MedicalRecordType {
  VACCINATION
  LAB_RESULT
  VISIT_SUMMARY
  PRESCRIPTION
  PROCEDURE
  DIAGNOSIS
  ALLERGY
  VITAL_SIGNS
  IMAGE
  DOCUMENT
}

enum VaccinationStatus {
  UP_TO_DATE
  DUE_SOON
  OVERDUE
  NOT_STARTED
}

enum AppointmentType {
  IN_PERSON_WELLNESS
  IN_PERSON_SICK_VISIT
  IN_PERSON_PROCEDURE
  IN_PERSON_FOLLOW_UP
  IN_PERSON_EMERGENCY
  VIRTUAL_CONSULTATION
  VIRTUAL_FOLLOW_UP
  VIRTUAL_URGENT_CARE
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  CHECKED_IN
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
  RESCHEDULED
}

model User {
  id                String    @id @default(uuid())
  email             String    @unique
  password          String
  firstName         String
  lastName          String
  phone             String?
  profileImage      String?
  isEmailVerified   Boolean   @default(false)
  twoFactorEnabled  Boolean   @default(false)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  ownedPets         Pet[]              @relation("PetOwner")
  petCaregivers     PetCaregiver[]
  appointments      Appointment[]
  messages          Message[]
  notifications     Notification[]
  preferences       NotificationPreferences?
  careTasksAssigned CareTask[]         @relation("AssignedCareTask")
  careTasksCreated  CareTask[]         @relation("CreatedCareTask")
  medicalRecords    MedicalRecord[]
  sharedRecords     MedicalRecordShare[]
  accessLogs        MedicalRecordAccessLog[]
  virtualConsultations VirtualConsultation[]
  refillRequests    RefillRequest[]
  travelPlans       TravelPlan[]

  @@index([email])
}

model Pet {
  id              String      @id @default(uuid())
  name            String
  type            PetType
  breed           String?
  gender          PetGender
  dateOfBirth     DateTime?
  weight          Float?
  weightUnit      String      @default("lbs")
  color           String?
  microchipId     String?     @unique
  profileImage    String?
  primaryOwnerId  String
  isActive        Boolean     @default(true)
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Relations
  primaryOwner    User        @relation("PetOwner", fields: [primaryOwnerId], references: [id], onDelete: Cascade)
  caregivers      PetCaregiver[]
  medicalRecords  MedicalRecord[]
  vaccinations    Vaccination[]
  prescriptions   Prescription[]
  allergies       Allergy[]
  vitalSigns      VitalSign[]
  appointments    Appointment[]
  careTasks       CareTask[]
  medicationReminders MedicationReminder[]
  wellnessReminders WellnessReminder[]
  travelPlans     TravelPlan[]
  travelDocuments TravelDocument[]
  petIdCards      PetIdCard[]

  @@index([primaryOwnerId])
  @@index([microchipId])
}

model PetCaregiver {
  id          String    @id @default(uuid())
  petId       String
  userId      String
  role        UserRole  @default(VIEWER)
  assignedBy  String
  assignedAt  DateTime  @default(now())
  isActive    Boolean   @default(true)

  // Relations
  pet         Pet       @relation(fields: [petId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([petId, userId])
  @@index([petId])
  @@index([userId])
}

model MedicalRecord {
  id                String              @id @default(uuid())
  petId             String
  type              MedicalRecordType
  title             String
  description       String?
  date              DateTime
  veterinarianName  String?
  clinicName        String?
  metadata          Json?
  createdBy         String
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  // Relations
  pet               Pet                 @relation(fields: [petId], references: [id], onDelete: Cascade)
  creator           User                @relation(fields: [createdBy], references: [id])
  attachments       MedicalRecordAttachment[]
  shares            MedicalRecordShare[]
  accessLogs        MedicalRecordAccessLog[]

  @@index([petId])
  @@index([type])
  @@index([date])
}

model MedicalRecordAttachment {
  id            String        @id @default(uuid())
  recordId      String
  fileName      String
  fileType      String
  fileSize      Int
  fileUrl       String
  thumbnailUrl  String?
  uploadedBy    String
  uploadedAt    DateTime      @default(now())

  // Relations
  record        MedicalRecord @relation(fields: [recordId], references: [id], onDelete: Cascade)

  @@index([recordId])
}

model MedicalRecordShare {
  id              String    @id @default(uuid())
  recordId        String
  petId           String
  sharedBy        String
  sharedWith      String?
  shareMethod     String
  recipient       String
  permissions     String    @default("READ_ONLY")
  expiresAt       DateTime?
  accessCount     Int       @default(0)
  lastAccessedAt  DateTime?
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  record          MedicalRecord @relation(fields: [recordId], references: [id], onDelete: Cascade)
  sharer          User      @relation(fields: [sharedBy], references: [id])

  @@index([recordId])
  @@index([sharedBy])
  @@index([recipient])
}

model MedicalRecordAccessLog {
  id          String    @id @default(uuid())
  recordId    String
  userId      String?
  shareId     String?
  action      String
  ipAddress   String?
  userAgent   String?
  timestamp   DateTime  @default(now())

  // Relations
  record      MedicalRecord @relation(fields: [recordId], references: [id], onDelete: Cascade)
  user        User?     @relation(fields: [userId], references: [id])

  @@index([recordId])
  @@index([userId])
  @@index([timestamp])
}

model Vaccination {
  id                String              @id @default(uuid())
  petId             String
  name              String
  administeredDate  DateTime
  expirationDate    DateTime?
  nextDueDate       DateTime?
  status            VaccinationStatus
  veterinarianName  String?
  clinicName        String?
  batchNumber       String?
  recordId          String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  // Relations
  pet               Pet                 @relation(fields: [petId], references: [id], onDelete: Cascade)

  @@index([petId])
  @@index([nextDueDate])
}

model Prescription {
  id                String    @id @default(uuid())
  petId             String
  medicationName    String
  dosage            String
  frequency         String
  instructions      String?
  prescribedDate    DateTime
  startDate         DateTime
  endDate           DateTime?
  refillsRemaining  Int?
  veterinarianName  String
  clinicName        String?
  recordId          String?
  isActive          Boolean   @default(true)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  pet               Pet       @relation(fields: [petId], references: [id], onDelete: Cascade)
  refillRequests    RefillRequest[]

  @@index([petId])
  @@index([isActive])
}

model Allergy {
  id              String    @id @default(uuid())
  petId           String
  allergen        String
  severity        String
  symptoms        String?
  diagnosedDate   DateTime?
  notes           String?
  recordId        String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  pet             Pet       @relation(fields: [petId], references: [id], onDelete: Cascade)

  @@index([petId])
}

model VitalSign {
  id                      String    @id @default(uuid())
  petId                   String
  recordDate              DateTime
  temperature             Float?
  temperatureUnit         String    @default("F")
  heartRate               Int?
  respiratoryRate         Int?
  weight                  Float?
  weightUnit              String    @default("lbs")
  bloodPressureSystolic   Int?
  bloodPressureDiastolic  Int?
  notes                   String?
  recordId                String?
  createdAt               DateTime  @default(now())

  // Relations
  pet                     Pet       @relation(fields: [petId], references: [id], onDelete: Cascade)

  @@index([petId])
  @@index([recordDate])
}

model Clinic {
  id                          String          @id @default(uuid())
  name                        String
  email                       String
  phone                       String
  website                     String?
  address                     Json
  hours                       Json[]
  services                    String[]
  isEmergency                 Boolean         @default(false)
  acceptsVirtualConsultations Boolean         @default(false)
  rating                      Float?
  reviewCount                 Int             @default(0)
  profileImage                String?
  coverImage                  String?
  description                 String?
  createdAt                   DateTime        @default(now())
  updatedAt                   DateTime        @updatedAt

  // Relations
  veterinarians               Veterinarian[]
  appointments                Appointment[]
  reviews                     Review[]

  @@index([name])
}

model Veterinarian {
  id                      String    @id @default(uuid())
  firstName               String
  lastName                String
  email                   String    @unique
  phone                   String?
  licenseNumber           String    @unique
  specialties             String[]
  bio                     String?
  profileImage            String?
  clinicId                String?
  isAvailableForVirtual   Boolean   @default(false)
  rating                  Float?
  reviewCount             Int       @default(0)
  yearsOfExperience       Int?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  // Relations
  clinic                  Clinic?   @relation(fields: [clinicId], references: [id])
  appointments            Appointment[]
  virtualConsultations    VirtualConsultation[]
  reviews                 Review[]
  appointmentSlots        AppointmentSlot[]

  @@index([email])
  @@index([clinicId])
}

model Appointment {
  id                          String              @id @default(uuid())
  petId                       String
  userId                      String
  type                        AppointmentType
  status                      AppointmentStatus   @default(SCHEDULED)
  scheduledDate               DateTime
  duration                    Int                 @default(30)
  reason                      String?
  symptoms                    String[]
  notes                       String?
  veterinarianId              String?
  veterinarianName            String?
  clinicId                    String?
  clinicName                  String?
  isVirtual                   Boolean             @default(false)
  videoRoomId                 String?
  preAppointmentFormCompleted Boolean             @default(false)
  reminderSent                Boolean             @default(false)
  createdAt                   DateTime            @default(now())
  updatedAt                   DateTime            @updatedAt

  // Relations
  pet                         Pet                 @relation(fields: [petId], references: [id], onDelete: Cascade)
  user                        User                @relation(fields: [userId], references: [id])
  veterinarian                Veterinarian?       @relation(fields: [veterinarianId], references: [id])
  clinic                      Clinic?             @relation(fields: [clinicId], references: [id])
  preAppointmentForm          PreAppointmentForm?
  virtualConsultation         VirtualConsultation?
  reminders                   AppointmentReminder[]

  @@index([petId])
  @@index([userId])
  @@index([scheduledDate])
  @@index([status])
}

model AppointmentSlot {
  id              String          @id @default(uuid())
  clinicId        String
  veterinarianId  String?
  date            DateTime
  startTime       String
  endTime         String
  duration        Int
  appointmentType AppointmentType
  isAvailable     Boolean         @default(true)
  maxBookings     Int             @default(1)
  currentBookings Int             @default(0)

  // Relations
  veterinarian    Veterinarian?   @relation(fields: [veterinarianId], references: [id])

  @@index([clinicId])
  @@index([veterinarianId])
  @@index([date])
}

model PreAppointmentForm {
  id                String    @id @default(uuid())
  appointmentId     String    @unique
  petId             String
  symptoms          String[]
  symptomDuration   String?
  appetite          String
  energy            String
  behaviorChanges   String?
  medications       String[]
  additionalNotes   String?
  photos            String[]
  completedAt       DateTime  @default(now())

  // Relations
  appointment       Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)

  @@index([appointmentId])
}

model VirtualConsultation {
  id                  String    @id @default(uuid())
  appointmentId       String    @unique
  petId               String
  veterinarianId      String
  userId              String
  startTime           DateTime
  endTime             DateTime?
  duration            Int?
  videoRoomId         String
  chatTranscript      Json?
  consultationNotes   String?
  followUpRequired    Boolean   @default(false)
  prescriptionsIssued String[]
  status              String    @default("SCHEDULED")
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  // Relations
  appointment         Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  veterinarian        Veterinarian @relation(fields: [veterinarianId], references: [id])
  user                User      @relation(fields: [userId], references: [id])

  @@index([appointmentId])
  @@index([veterinarianId])
  @@index([userId])
}

model AppointmentReminder {
  id              String    @id @default(uuid())
  appointmentId   String
  userId          String
  reminderType    String
  scheduledFor    DateTime
  sentAt          DateTime?
  status          String    @default("PENDING")

  // Relations
  appointment     Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)

  @@index([appointmentId])
  @@index([scheduledFor])
}

model CareTask {
  id                String    @id @default(uuid())
  petId             String
  type              String
  title             String
  description       String?
  assignedTo        String
  assignedBy        String
  scheduledTime     DateTime
  dueTime           DateTime?
  completedAt       DateTime?
  completedBy       String?
  status            String    @default("PENDING")
  priority          String    @default("MEDIUM")
  recurring         Boolean   @default(false)
  recurrencePattern Json?
  dosage            String?
  medication        String?
  notes             String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  pet               Pet       @relation(fields: [petId], references: [id], onDelete: Cascade)
  assignee          User      @relation("AssignedCareTask", fields: [assignedTo], references: [id])
  assigner          User      @relation("CreatedCareTask", fields: [assignedBy], references: [id])

  @@index([petId])
  @@index([assignedTo])
  @@index([scheduledTime])
  @@index([status])
}

model MedicationReminder {
  id                  String    @id @default(uuid())
  petId               String
  prescriptionId      String?
  medicationName      String
  dosage              String
  frequency           String
  times               String[]
  startDate           DateTime
  endDate             DateTime?
  reminderEnabled     Boolean   @default(true)
  notificationMethod  String[]
  assignedTo          String[]
  notes               String?
  isActive            Boolean   @default(true)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  // Relations
  pet                 Pet       @relation(fields: [petId], references: [id], onDelete: Cascade)
  logs                MedicationLog[]

  @@index([petId])
  @@index([isActive])
}

model MedicationLog {
  id              String            @id @default(uuid())
  reminderId      String
  petId           String
  administeredAt  DateTime
  administeredBy  String
  dosageGiven     String
  notes           String?
  wasOnTime       Boolean           @default(true)
  createdAt       DateTime          @default(now())

  // Relations
  reminder        MedicationReminder @relation(fields: [reminderId], references: [id], onDelete: Cascade)

  @@index([reminderId])
  @@index([petId])
}

model WellnessReminder {
  id                String    @id @default(uuid())
  petId             String
  type              String
  title             String
  description       String?
  dueDate           DateTime
  reminderDate      DateTime
  isRecurring       Boolean   @default(false)
  recurrencePattern Json?
  notificationSent  Boolean   @default(false)
  completedAt       DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  pet               Pet       @relation(fields: [petId], references: [id], onDelete: Cascade)

  @@index([petId])
  @@index([dueDate])
}

model RefillRequest {
  id              String        @id @default(uuid())
  petId           String
  prescriptionId  String
  medicationName  String
  requestedBy     String
  requestedAt     DateTime      @default(now())
  status          String        @default("PENDING")
  clinicId        String?
  pharmacyId      String?
  deliveryMethod  String?
  deliveryAddress String?
  approvedAt      DateTime?
  filledAt        DateTime?
  notes           String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relations
  prescription    Prescription  @relation(fields: [prescriptionId], references: [id], onDelete: Cascade)
  requester       User          @relation(fields: [requestedBy], references: [id])

  @@index([prescriptionId])
  @@index([requestedBy])
  @@index([status])
}

model Conversation {
  id            String    @id @default(uuid())
  participants  String[]
  petId         String?
  clinicId      String?
  type          String
  unreadCount   Int       @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  messages      Message[]

  @@index([petId])
  @@index([clinicId])
}

model Message {
  id              String        @id @default(uuid())
  conversationId  String
  senderId        String
  senderName      String
  senderType      String
  type            String        @default("TEXT")
  content         String
  attachments     Json?
  status          String        @default("SENT")
  replyTo         String?
  metadata        Json?
  sentAt          DateTime      @default(now())
  deliveredAt     DateTime?
  readAt          DateTime?

  // Relations
  conversation    Conversation  @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender          User          @relation(fields: [senderId], references: [id])

  @@index([conversationId])
  @@index([senderId])
  @@index([sentAt])
}

model Notification {
  id          String    @id @default(uuid())
  userId      String
  type        String
  title       String
  body        String
  data        Json?
  priority    String    @default("MEDIUM")
  isRead      Boolean   @default(false)
  actionUrl   String?
  expiresAt   DateTime?
  createdAt   DateTime  @default(now())
  readAt      DateTime?

  // Relations
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
}

model NotificationPreferences {
  userId                  String    @id
  pushEnabled             Boolean   @default(true)
  emailEnabled            Boolean   @default(true)
  smsEnabled              Boolean   @default(false)
  appointmentReminders    Boolean   @default(true)
  medicationReminders     Boolean   @default(true)
  messageNotifications    Boolean   @default(true)
  wellnessReminders       Boolean   @default(true)
  marketingEmails         Boolean   @default(false)
  quietHoursEnabled       Boolean   @default(false)
  quietHoursStart         String?
  quietHoursEnd           String?
  updatedAt               DateTime  @updatedAt

  // Relations
  user                    User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model TravelPlan {
  id                String    @id @default(uuid())
  petId             String
  userId            String
  destination       String
  departureDate     DateTime
  returnDate        DateTime?
  travelMode        String
  airline           String?
  flightNumber      String?
  notes             String?
  complianceStatus  String    @default("INCOMPLETE")
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  pet               Pet       @relation(fields: [petId], references: [id], onDelete: Cascade)
  user              User      @relation(fields: [userId], references: [id])
  documents         TravelDocument[]
  checklist         ComplianceChecklist?

  @@index([petId])
  @@index([userId])
  @@index([departureDate])
}

model TravelDocument {
  id                String    @id @default(uuid())
  petId             String
  travelPlanId      String?
  documentType      String
  documentName      String
  documentUrl       String
  issueDate         DateTime
  expirationDate    DateTime?
  issuingAuthority  String?
  isVerified        Boolean   @default(false)
  status            String    @default("INCOMPLETE")
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  pet               Pet       @relation(fields: [petId], references: [id], onDelete: Cascade)
  travelPlan        TravelPlan? @relation(fields: [travelPlanId], references: [id])

  @@index([petId])
  @@index([travelPlanId])
}

model ComplianceChecklist {
  id              String      @id @default(uuid())
  petId           String
  travelPlanId    String      @unique
  items           Json
  overallStatus   String      @default("INCOMPLETE")
  lastUpdated     DateTime    @updatedAt

  // Relations
  travelPlan      TravelPlan  @relation(fields: [travelPlanId], references: [id], onDelete: Cascade)

  @@index([travelPlanId])
}

model PetIdCard {
  id          String    @id @default(uuid())
  petId       String
  qrCodeUrl   String
  cardUrl     String
  generatedAt DateTime  @default(now())
  expiresAt   DateTime?

  // Relations
  pet         Pet       @relation(fields: [petId], references: [id], onDelete: Cascade)

  @@index([petId])
}

model Review {
  id              String        @id @default(uuid())
  clinicId        String?
  veterinarianId  String?
  userId          String
  rating          Int
  title           String?
  comment         String?
  appointmentId   String?
  isVerified      Boolean       @default(false)
  isPublished     Boolean       @default(true)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relations
  clinic          Clinic?       @relation(fields: [clinicId], references: [id])
  veterinarian    Veterinarian? @relation(fields: [veterinarianId], references: [id])

  @@index([clinicId])
  @@index([veterinarianId])
  @@index([rating])
}
